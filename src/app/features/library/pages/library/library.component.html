<div class="library">

  <h2>ðŸŽµ BibliothÃ¨que musicale</h2>

  <!-- ðŸ” Recherche -->
  <input
    type="text"
    placeholder="Rechercher par titre ou artiste"
    [(ngModel)]="searchTerm"
    class="search-input"
  />

  <!-- ðŸŽ¼ Filtre catÃ©gorie -->
  <select [(ngModel)]="selectedCategory" class="filter-select">
    <option value="all">Toutes les catÃ©gories</option>
    <option value="pop">Pop</option>
    <option value="rock">Rock</option>
    <option value="rap">Rap</option>
    <option value="jazz">Jazz</option>
    <option value="classical">Classique</option>
    <option value="other">Autre</option>
  </select>

  <!-- â³ Chargement -->
  <p *ngIf="(trackService.state$ | async) === 'loading'">
    Chargement des tracks...
  </p>

  <!-- âŒ Erreur -->
  <p class="error" *ngIf="(trackService.state$ | async) === 'error'">
    {{ trackService.error$ | async }}
  </p>

  <!-- ðŸ“ƒ Liste -->
  <ng-container *ngIf="trackService.tracks$ | async as tracks">
    <ul *ngIf="tracks.length > 0">
      <li *ngFor="let track of filterTracks(tracks)">
        <strong>{{ track.title }}</strong> â€“ {{ track.artist }}
        <span class="category">({{ track.category }})</span>

        <div class="actions">
          <a [routerLink]="['/track', track.id]">â–¶ Lire</a>
          <button (click)="deleteTrack(track.id)">ðŸ—‘ Supprimer</button>
        </div>
      </li>
    </ul>

    <!-- ðŸš« Aucun rÃ©sultat -->
    <p *ngIf="tracks.length === 0">
      Aucun track dans la bibliothÃ¨que.
    </p>
  </ng-container>

</div>

<hr />

<h3>âž• Ajouter un track</h3>

<form [formGroup]="trackForm" (ngSubmit)="submit()">

  <input formControlName="title" placeholder="Titre" />
  <small *ngIf="trackForm.get('title')?.touched && trackForm.get('title')?.invalid">
    Titre requis (max 50 caractÃ¨res)
  </small>

  <input formControlName="artist" placeholder="Artiste" />
  <small *ngIf="trackForm.get('artist')?.touched && trackForm.get('artist')?.invalid">
    Artiste requis
  </small>

  <textarea
    formControlName="description"
    placeholder="Description (optionnelle)">
  </textarea>

  <select formControlName="category">
    <option value="pop">Pop</option>
    <option value="rock">Rock</option>
    <option value="rap">Rap</option>
    <option value="jazz">Jazz</option>
    <option value="classical">Classique</option>
    <option value="other">Autre</option>
  </select>

  <input type="file" (change)="onFileSelected($event)" />

  <p class="error" *ngIf="fileError">{{ fileError }}</p>

  <button type="submit" [disabled]="trackForm.invalid || fileError">
    Ajouter
  </button>

</form>
